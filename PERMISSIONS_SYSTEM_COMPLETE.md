# โ ูุธุงู ุงูุตูุงุญูุงุช ุงููุงูู - ุชู ุงูุชูููุฐ ุจูุฌุงุญ

## ๐ ููุฎุต ุดุงูู

ุชู ุจูุฌุงุญ ุชุทุจูู ูุธุงู ุตูุงุญูุงุช ูุชูุงูู ุนูู ุงููุดุฑูุน ูุชุถูู:
1. โ ุซูุงุซุฉ ุฃููุงุน ูู ุงููุณุชุฎุฏููู (Roles)
2. โ ุตูุงุญูุงุช ููุตูุฉ ููู ููุน
3. โ ุฅุฎูุงุก/ุฅุธูุงุฑ ุนูุงุตุฑ ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ ุญุณุจ ุงูุตูุงุญูุงุช
4. โ ุฅุฏุงุฑุฉ ูุงููุฉ ูููุณุชุฎุฏููู ูุน ุงุฎุชูุงุฑ ุงูุฃุฏูุงุฑ
5. โ ูุธุงู ุชุณุฌูู ุฏุฎูู ูุชูุงูู

---

## ๐ฅ ุฃููุงุน ุงููุณุชุฎุฏููู (Roles)

### 1. **Aviation Department** (ูุณู ุงูุทูุฑุงู ูุงูุนูุฑุฉ)
**Username:** `aviation`  
**Password:** `aviation123`

**ูุง ูุธูุฑ ูู ุงููุงุฆูุฉ:**
- โ ๐ ููุญุฉ ุงูุชุญูู (Dashboard)
- โ ๐ซ ุงูุทูุฑุงู (Flight Bookings)
- โ ๐ ุงูุนูุฑุฉ (Umrah Packages)
- โ ๐งฎ ุงูุขูุฉ ุงูุญุงุณุจุฉ (Calculator)

**ูุง ูุฎุชูู:**
- โ ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู
- โ ุงูุฅุนุฏุงุฏุงุช
- โ ุดุฌุฑุฉ ุงูุญุณุงุจุงุช
- โ ุงูุนููุงุก ูุงูููุฑุฏูู
- โ ุงูุญุฌูุฒุงุช ุงูุนุงูุฉ
- โ ุงูุฑุญูุงุช
- โ ุงูููุงุชูุฑ
- โ ุงูุฎุฒูุฉ ูุงูุจููู
- โ ุงููููุฏ ุงูููููุฉ
- โ ุงูุชูุงุฑูุฑ ุงููุญุงุณุจูุฉ

---

### 2. **Operations Department** (ูุณู ุงูุนูููุงุช)
**Username:** `operations`  
**Password:** `operations123`

**ูุง ูุธูุฑ ูู ุงููุงุฆูุฉ:**
- โ ๐ ููุญุฉ ุงูุชุญูู (Dashboard)
- โ ๐ ุงูุฑุญูุงุช (Trips)
- โ ๐งฎ ุงูุขูุฉ ุงูุญุงุณุจุฉ (Calculator)
- โ ๐ ุชูุงุฑูุฑ ุงูุฑุญูุงุช

**ูุง ูุฎุชูู:**
- โ ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู
- โ ุงูุฅุนุฏุงุฏุงุช
- โ ุดุฌุฑุฉ ุงูุญุณุงุจุงุช
- โ ุงูุนููุงุก ูุงูููุฑุฏูู
- โ ุงูุญุฌูุฒุงุช
- โ ุงูุทูุฑุงู
- โ ุงูุนูุฑุฉ
- โ ุงูููุงุชูุฑ
- โ ุงูุฎุฒูุฉ ูุงูุจููู
- โ ุงููููุฏ ุงูููููุฉ
- โ ุงูุชูุงุฑูุฑ ุงููุญุงุณุจูุฉ

---

### 3. **Administrator** (ุงููุฏูุฑ)
**Username:** `admin`  
**Password:** `admin123`

**ูุง ูุธูุฑ ูู ุงููุงุฆูุฉ:**
- โ **ูู ุดูุก!**
- โ ๐ ููุญุฉ ุงูุชุญูู
- โ โ๏ธ ุงูุฅุนุฏุงุฏุงุช
- โ ๐ค ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู
- โ ๐ณ ุดุฌุฑุฉ ุงูุญุณุงุจุงุช
- โ ๐ฅ ุงูุนููุงุก
- โ ๐ข ุงูููุฑุฏูู
- โ โ๏ธ ุงูุญุฌูุฒุงุช
- โ ๐ซ ุงูุทูุฑุงู
- โ ๐ ุงูุฑุญูุงุช
- โ ๐ ุงูุนูุฑุฉ
- โ ๐ ุงูููุงุชูุฑ
- โ ๐ฐ ุงูุฎุฒูุฉ
- โ ๐ฆ ุงูุจููู
- โ ๐ ุงููููุฏ ุงูููููุฉ
- โ ๐งฎ ุงูุขูุฉ ุงูุญุงุณุจุฉ
- โ ๐ ุงูุชูุงุฑูุฑ
- โ ๐ ุงูุชูุงุฑูุฑ ุงููุญุงุณุจูุฉ

---

## ๐ง ุงููููุงุช ุงููุนุฏููุฉ ูู ูุฐู ุงูุฌูุณุฉ

### 1. **SidebarControl.cs**
**ุงููุณุงุฑ:** `Presentation\Controls\SidebarControl.cs`

**ุงูุชุนุฏููุงุช:**
```csharp
// 1. ุฅุถุงูุฉ using ููู Permissions
using GraceWay.AccountingSystem.Domain.Entities;

// 2. ุฅุถุงูุฉ ูุชุบูุฑุงุช ุฌุฏูุฏุฉ
private IPermissionService? _permissionService;
private int _currentUserId;

// 3. ุชุนุฏูู InitializeServices ูุงุณุชูุจุงู IPermissionService
public void InitializeServices(
    IReservationService reservationService,
    ICustomerService customerService,
    ISupplierService supplierService,
    ITripService tripService,
    IUmrahService umrahService,
    IInvoiceService invoiceService,
    IPermissionService permissionService,  // โ ุฌุฏูุฏ
    int currentUserId)  // โ ุฌุฏูุฏ

// 4. ุฅุถุงูุฉ ุฏุงูุฉ ApplyPermissionsAsync()
private async Task ApplyPermissionsAsync()
{
    // ุชุทุจูู ุงูุตูุงุญูุงุช ุนูู ูู ุนูุตุฑ ูู ุงููุงุฆูุฉ
    var permissionsByModule = await _permissionService
        .GetUserPermissionsByModuleAsync(_currentUserId);
    
    SetMenuItemVisibility("users", permissionsByModule.ContainsKey("System"));
    SetMenuItemVisibility("accounts", permissionsByModule.ContainsKey("Accounting"));
    // ... ุฅูุฎ
}

// 5. ุฅุถุงูุฉ ุฒุฑ "ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู"
AddMenuItem("users", "๐ค", "ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู", ref yPosition);
```

---

### 2. **MainForm.cs**
**ุงููุณุงุฑ:** `Presentation\Forms\MainForm.cs`

**ุงูุชุนุฏููุงุช:**
```csharp
// 1. ุฅุถุงูุฉ IPermissionService ูู SetupMainLayout()
var permissionService = _serviceProvider.GetRequiredService<IPermissionService>();

_sidebar.InitializeServices(
    reservationService,
    customerService,
    supplierService,
    tripService,
    umrahService,
    invoiceService,
    permissionService,  // โ ุฌุฏูุฏ
    _currentUserId);    // โ ุฌุฏูุฏ

// 2. ุฅุถุงูุฉ case ุฌุฏูุฏ ูู Sidebar_MenuItemClicked
case "users":
    ShowUserManagement();
    break;

// 3. ุฅุถุงูุฉ ุฏุงูุฉ ShowUserManagement()
private void ShowUserManagement()
{
    _contentPanel?.Controls.Clear();
    var dbContext = _serviceProvider.GetRequiredService<AppDbContext>();
    var userManagementForm = new Admin.UserManagementForm(dbContext)
    {
        TopLevel = false,
        FormBorderStyle = FormBorderStyle.None,
        Dock = DockStyle.Fill
    };
    _contentPanel?.Controls.Add(userManagementForm);
    userManagementForm.Show();
}
```

---

## ๐ ุงููููุงุช ุงูููุฌูุฏุฉ ูุณุจูุงู (ูู ูุชู ุชุนุฏูููุง)

### 1. **IPermissionService.cs**
`Application\Services\IPermissionService.cs`
- โ ููุฌูุฏ ููุนูู
- ูููุฑ ุฌููุน ุฏูุงู ูุญุต ุงูุตูุงุญูุงุช
- ูุธุงู Cache ุฐูู (10 ุฏูุงุฆู)

### 2. **PermissionSeeder.cs**
`Infrastructure\Data\PermissionSeeder.cs`
- โ ููุฌูุฏ ููุนูู
- ููุดุฆ ุงูุฃุฏูุงุฑ ุงูุซูุงุซุฉ
- ูุฑุจุท ุงูุตูุงุญูุงุช ุจูู ุฏูุฑ
- ููุดุฆ ูุณุชุฎุฏููู ุชุฌุฑูุจููู

### 3. **UserManagementForm.cs**
`Presentation\Forms\Admin\UserManagementForm.cs`
- โ ููุฌูุฏ ููุนูู
- ุนุฑุถ ุฌููุน ุงููุณุชุฎุฏููู
- ููุชุฑ ุจุงูุฃุฏูุงุฑ
- ุจุญุซ ุจุงูุงุณู
- ุฅุถุงูุฉ/ุชุนุฏูู/ุญุฐู

### 4. **AddEditUserForm.cs**
`Presentation\Forms\Admin\AddEditUserForm.cs`
- โ ููุฌูุฏ ููุนูู
- ุฅุถุงูุฉ ูุณุชุฎุฏู ุฌุฏูุฏ
- ุชุนุฏูู ูุณุชุฎุฏู ููุฌูุฏ
- ุงุฎุชูุงุฑ ุงูุฏูุฑ ูู ComboBox
- ุชุดููุฑ ูููุฉ ุงููุฑูุฑ

### 5. **ChangePasswordForm.cs**
`Presentation\Forms\Admin\ChangePasswordForm.cs`
- โ ููุฌูุฏ ููุนูู
- ุชุบููุฑ ูููุฉ ูุฑูุฑ ุงููุณุชุฎุฏููู

---

## ๐งช ููููุฉ ุงูุงุฎุชุจุงุฑ

### ุงูุฎุทูุฉ 1: ุชุดุบูู ุงูู Seeder
```bash
cd C:\Users\musta\Desktop\pro\accountant
dotnet run --project Infrastructure/Data/SeedPermissions_Program.cs
```

### ุงูุฎุทูุฉ 2: ุงุฎุชุจุงุฑ ุชุณุฌูู ุงูุฏุฎูู

#### Test 1: Aviation User
1. ุชุณุฌูู ุงูุฏุฎูู ุจู `aviation` / `aviation123`
2. โ ูุฌุจ ุฃู ุชุฑู: Dashboard + ุงูุทูุฑุงู + ุงูุนูุฑุฉ + ุงูุขูุฉ ุงูุญุงุณุจุฉ ููุท
3. โ ูุง ูุฌุจ ุฃู ุชุฑู: ุงูุฑุญูุงุชุ ุงููุญุงุณุจุฉุ ุงูุฅุนุฏุงุฏุงุชุ ุฅูุฎ

#### Test 2: Operations User
1. ุชุณุฌูู ุงูุฏุฎูู ุจู `operations` / `operations123`
2. โ ูุฌุจ ุฃู ุชุฑู: Dashboard + ุงูุฑุญูุงุช + ุงูุขูุฉ ุงูุญุงุณุจุฉ ููุท
3. โ ูุง ูุฌุจ ุฃู ุชุฑู: ุงูุทูุฑุงูุ ุงูุนูุฑุฉุ ุงููุญุงุณุจุฉุ ุฅูุฎ

#### Test 3: Admin User
1. ุชุณุฌูู ุงูุฏุฎูู ุจู `admin` / `admin123`
2. โ ูุฌุจ ุฃู ุชุฑู: **ูู ุนูุงุตุฑ ุงููุงุฆูุฉ**
3. โ ููููู ุงูุฏุฎูู ุนูู "ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู" ูุฅุฏุงุฑุฉ ุฌููุน ุงููุณุชุฎุฏููู

---

## ๐ฏ ููุงุญุธุงุช ูููุฉ

### ูุธุงู ุงูู Modules
ุงูุตูุงุญูุงุช ููุณูุฉ ุญุณุจ Modules:
- `Trips` โ ุงูุฑุญูุงุช
- `Aviation` โ ุงูุทูุฑุงู
- `Umrah` โ ุงูุนูุฑุฉ
- `Accounting` โ ุงููุญุงุณุจุฉ
- `CashBox` โ ุงูุฎุฒูุฉ
- `Banks` โ ุงูุจููู
- `JournalEntries` โ ุงููููุฏ ุงูููููุฉ
- `Reports` โ ุงูุชูุงุฑูุฑ
- `Settings` โ ุงูุฅุนุฏุงุฏุงุช
- `System` โ ุฅุฏุงุฑุฉ ุงููุธุงู (ุงููุณุชุฎุฏููู)

### ุงูุขูุฉ ุงูุญุงุณุจุฉ ู Dashboard
- ูุชุงุญุฉ ููุฌููุน ุจุฏูู ุตูุงุญูุงุช
- ูุง ูููู ุฅุฎูุงุคูุง

### ูุธุงู ุงูู Cache
- ุงูุตูุงุญูุงุช ูุชู ุชุฎุฒูููุง ูู Cache ููุฏุฉ 10 ุฏูุงุฆู
- ูุชุญุฏูุซ ุงูุตูุงุญูุงุช ููุฑุงู ุจุนุฏ ุงูุชุนุฏููุ ุงุณุชุฎุฏู:
  ```csharp
  _permissionService.ClearCache(userId);
  ```

---

## โ ุงูุฎูุงุตุฉ

ุชู ุชุทุจูู ูุธุงู ุตูุงุญูุงุช ูุงูู ููุชูุงูู ูุชุถูู:
1. โ 3 ุฃููุงุน ูู ุงููุณุชุฎุฏููู
2. โ ุตูุงุญูุงุช ููุตูุฉ ููู ููุน
3. โ ุฅุฎูุงุก/ุฅุธูุงุฑ ุนูุงุตุฑ ุงููุงุฆูุฉ ุญุณุจ ุงูุตูุงุญูุงุช
4. โ ุฒุฑ "ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู" ูู ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ
5. โ ุตูุญุฉ ุฅุฏุงุฑุฉ ูุณุชุฎุฏููู ูุงููุฉ ูุน ููุงุชุฑ ูุจุญุซ
6. โ ุฅููุงููุฉ ุฅุถุงูุฉ/ุชุนุฏูู/ุญุฐู ุงููุณุชุฎุฏููู
7. โ ุงุฎุชูุงุฑ ุงูุฏูุฑ ุนูุฏ ุฅุถุงูุฉ/ุชุนุฏูู ูุณุชุฎุฏู
8. โ ุชุบููุฑ ูููุฉ ุงููุฑูุฑ
9. โ ูุธุงู Cache ุฐูู
10. โ ุชุดููุฑ ูููุงุช ุงููุฑูุฑ

**ุงููุธุงู ุฌุงูุฒ ููุงุณุชุฎุฏุงู ุงูููุฑู! ๐**