# ุฏููู ุงูุจุฏุก ุงูุณุฑูุน - Multi-User Support

## ๐ ุงููุชุทูุจุงุช ุงูุฃุณุงุณูุฉ

### 1. PostgreSQL Configuration
```bash
# ุชุดุบูู ุงูุณูุฑูุจุช ูู postgres user
psql -U postgres -d graceway_accounting -f configure_postgres_multiuser.sql
```

### 2. ุฅุนุงุฏุฉ ุชุดุบูู PostgreSQL
```bash
# Windows
net stop postgresql-x64-14
net start postgresql-x64-14

# ุฃู ูู Services.msc
```

### 3. ุชุทุจูู Migration
```bash
# ูู Visual Studio Package Manager Console
Update-Database

# ุฃู ูู Terminal
dotnet ef database update
```

## ๐ ุงูุฅุนุฏุงุฏ ุงูุฃููู

### 1. ูุญุต Connection String
ุชุฃูุฏ ูู ููู `appsettings.json`:
```json
{
  "ConnectionStrings": {
    "DefaultConnection": "Host=localhost;Port=5432;Database=graceway_accounting;Username=postgres;Password=123456;Timeout=60;Command Timeout=60;Pooling=true;MinPoolSize=10;MaxPoolSize=100;..."
  }
}
```

### 2. Build ุงููุดุฑูุน
```bash
dotnet build --configuration Release
```

### 3. ุชุดุบูู ุงูุจุฑูุงูุฌ
- ุงูุชุญ ุงูุจุฑูุงูุฌ ุนูู ุฃูู ุฌูุงุฒ
- ุณุฌู ุฏุฎูู ูู Admin
- ุงูุชุญ "ุงูุฌูุณุงุช ุงููุดุทุฉ" ููุชุฃูุฏ ูู ุงูุงุชุตุงู

## โ ุงุฎุชุจุงุฑ Multi-User

### ุทุฑููุฉ ุงูุงุฎุชุจุงุฑ ุงููุฏููุฉ:

#### ุนูู ุงูุฌูุงุฒ ุงูุฃูู:
1. ุงูุชุญ ุงูุจุฑูุงูุฌ
2. ุณุฌู ุฏุฎูู ุจูุณุชุฎุฏู "Admin"
3. ุงูุชุญ ุงูุฎุฒูุฉ
4. ูุงุญุธ ุงูุฑุตูุฏ ุงูุญุงูู

#### ุนูู ุงูุฌูุงุฒ ุงูุซุงูู:
1. ุงูุชุญ ุงูุจุฑูุงูุฌ ูู ููุณ ุงูุดุจูุฉ
2. ุณุฌู ุฏุฎูู ุจูุณุชุฎุฏู ุขุฎุฑ
3. ุงูุชุญ ููุณ ุงูุฎุฒูุฉ
4. ุญุงูู ุฅุถุงูุฉ ุญุฑูุฉ ูุงููุฉ

#### ุงููุชูุฌุฉ ุงููุชููุนุฉ:
- โ ููุง ุงููุณุชุฎุฏููู ูุฑู ุงูุจูุงูุงุช ูุญุฏุซุฉ
- โ ูุง ุชูุฌุฏ ุชุนุงุฑุถุงุช ูู ุงูุฑุตูุฏ
- โ ูู ุญุฑูุฉ ูุณุฌูุฉ ุจุดูู ุตุญูุญ

### ุทุฑููุฉ ุงูุงุฎุชุจุงุฑ ุงูุชููุงุฆูุฉ:

```bash
# ุชุซุจูุช ุงููุชุทูุจุงุช
pip install psycopg2-binary

# ุชุดุบูู ุงูุงุฎุชุจุงุฑุงุช
python test_multi_user.py
```

## ๐ ูุฑุงูุจุฉ ุงูุฌูุณุงุช ุงููุดุทุฉ

### ูู ุฏุงุฎู ุงูุจุฑูุงูุฌ:
1. ุณุฌู ุฏุฎูู ูู Admin
2. ุงุถุบุท ุนูู "๐ ุงูุฌูุณุงุช ุงููุดุทุฉ" ูู ุงููุงุฆูุฉ
3. ุณุชุดุงูุฏ:
   - ุนุฏุฏ ุงูุฌูุณุงุช ุงููุดุทุฉ
   - ุงุณู ุงููุณุชุฎุฏู ููู ุฌูุณุฉ
   - ุงุณู ุงูุฌูุงุฒ
   - ููุช ุชุณุฌูู ุงูุฏุฎูู
   - ุขุฎุฑ ูุดุงุท
   - ูุฏุฉ ุงูุฌูุณุฉ

### ูู PostgreSQL:
```sql
-- ุนุฑุถ ุงูุฌูุณุงุช ุงููุดุทุฉ
SELECT * FROM active_sessions;

-- ุนุฑุถ ุฅุญุตุงุฆูุงุช ุงูุงุชุตุงูุงุช
SELECT * FROM connection_stats;

-- ูุญุต ุงูู locks
SELECT * FROM lock_stats;

-- ูุญุต ุงูุงุณุชุนูุงูุงุช ุงููุนููุฉ
SELECT * FROM check_blocking_queries();
```

## ๐ง ุงุณุชูุดุงู ุงูุฃุฎุทุงุก ุงูุดุงุฆุนุฉ

### ูุดููุฉ 1: "Could not connect to server"
**ุงูุณุจุจ:** PostgreSQL ุบูุฑ ูุดุบู ุฃู ุงูู firewall ูููุน ุงูุงุชุตุงู

**ุงูุญู:**
```bash
# ุชุญูู ูู ุชุดุบูู PostgreSQL
services.msc โ PostgreSQL โ Status

# ุชุญูู ูู ุงูุงุณุชูุงุน ุนูู ุงููููุฐ
netstat -an | findstr 5432

# ุงุณูุญ ุจุงูุงุชุตุงู ูู ุงูุดุจูุฉ ุงูุฏุงุฎููุฉ
# ูู pg_hba.conf ุฃุถู:
host    graceway_accounting    postgres    192.168.1.0/24    md5
```

### ูุดููุฉ 2: "Connection pool exhausted"
**ุงูุณุจุจ:** ุนุฏุฏ ูุจูุฑ ุฌุฏุงู ูู ุงูุงุชุตุงูุงุช ุงูููุชูุญุฉ

**ุงูุญู:**
```sql
-- ูุญุต ุนุฏุฏ ุงูุงุชุตุงูุงุช
SELECT COUNT(*) FROM pg_stat_activity 
WHERE datname = 'graceway_accounting';

-- ุฅุบูุงู ุงูุงุชุตุงูุงุช ุงููุฏููุฉ
SELECT pg_terminate_backend(pid)
FROM pg_stat_activity
WHERE datname = 'graceway_accounting'
AND state = 'idle'
AND state_change < NOW() - INTERVAL '1 hour';
```

### ูุดููุฉ 3: "ุชู ุชุนุฏูู ุงูุณุฌู ุจูุงุณุทุฉ ูุณุชุฎุฏู ุขุฎุฑ"
**ุงูุณุจุจ:** ุชุนุงุฑุถ ูู ุงูุชุญุฏูุซ ุงููุชุฒุงูู (ูุฐุง ุทุจูุนู!)

**ุงูุญู:**
- ุงููุฑ "OK" ูู ุงูุฑุณุงูุฉ
- ุณูุชู ุฅุนุงุฏุฉ ุงููุญุงููุฉ automatically
- ุฅุฐุง ุชูุฑุฑุ ุฃุนุฏ ุชุญููู ุงูุจูุงูุงุช

### ูุดููุฉ 4: ุจุทุก ูู ุงูุฃุฏุงุก
**ุงูุฃุณุจุงุจ ุงููุญุชููุฉ:**
1. ุนุฏุฏ ูุจูุฑ ูู ุงูุฌูุณุงุช ุงูุฎุงููุฉ
2. ุงุณุชุนูุงูุงุช ุจุทูุฆุฉ
3. ููุต ูู ููุงุฑุฏ ุงูุฎุงุฏู

**ุงูุญู:**
```sql
-- ุชูุธูู ุงูุฌูุณุงุช ุงููุฏููุฉ
-- ูู ุฏุงุฎู ุงูุจุฑูุงูุฌ: ุงูุฌูุณุงุช ุงููุดุทุฉ โ ุชูุธูู

-- ูุญุต ุงูุงุณุชุนูุงูุงุช ุงูุจุทูุฆุฉ
SELECT 
    pid,
    now() - query_start as duration,
    query
FROM pg_stat_activity
WHERE state = 'active'
AND query NOT LIKE '%pg_stat_activity%'
ORDER BY duration DESC;
```

## ๐ ุฃูุถู ุงูููุงุฑุณุงุช

### ูููุณุชุฎุฏููู:
1. โ ุณุฌู ุฎุฑูุฌ ุนูุฏ ุงูุงูุชูุงุก ูู ุงูุนูู
2. โ ูุง ุชุชุฑู ุงูุจุฑูุงูุฌ ููุชูุญ ุจุฏูู ุงุณุชุฎุฏุงู
3. โ ุชุฌูุจ ุชุนุฏูู ููุณ ุงูุณุฌูุงุช ูุน ูุณุชุฎุฏููู ุขุฎุฑูู
4. โ ุงุญูุธ ุนููู ุจุดูู ูุชูุฑุฑ

### ููู Admin:
1. โ ุฑุงูุจ ุงูุฌูุณุงุช ุงููุดุทุฉ ุจุงูุชุธุงู
2. โ ูุธู ุงูุฌูุณุงุช ุงูุฎุงููุฉ ุฃุณุจูุนูุงู
3. โ ุฑุงูุจ ุฃุฏุงุก ูุงุนุฏุฉ ุงูุจูุงูุงุช
4. โ ุงุญุชูุธ ุจูุณุฎ ุงุญุชูุงุทูุฉ ููููุฉ

### ูููุทูุฑูู:
1. โ ุงุณุชุฎุฏู ConcurrencyExceptionHandler ููุชุญุฏูุซุงุช
2. โ ุงุณุชุฎุฏู TransactionScopeHelper ููุนูููุงุช ุงููุงููุฉ
3. โ ุงุณุชุฎุฏู using statements ูุน DbContext
4. โ ุชุฌูุจ AsNoTracking ูู Update operations
5. โ ุงุณุชุฎุฏู proper isolation levels

## ๐ฏ ูุงุฆูุฉ ุงูุชุญูู

### ูุจู ุงูุชุดุบูู ุนูู ุงูุดุจูุฉ:
- [ ] PostgreSQL ููููุฃ ููู multi-user
- [ ] Connection pooling ูููุนูู
- [ ] Firewall ูุณูุญ ุจุงูุงุชุตุงูุงุช
- [ ] ูู ุงูุฃุฌูุฒุฉ ุนูู ููุณ ุงูุดุจูุฉ
- [ ] ุชู ุงุฎุชุจุงุฑ ุงูุงุชุตุงู ูู ุฌูุงุฒ ูุงุญุฏ ุนูู ุงูุฃูู

### ุจุนุฏ ุงูุชุดุบูู:
- [ ] ุงูุฌูุณุงุช ุงููุดุทุฉ ุชุธูุฑ ุจุดูู ุตุญูุญ
- [ ] ุงููุณุชุฎุฏููู ูููููู ุชุณุฌูู ุงูุฏุฎูู
- [ ] ุงูุนูููุงุช ุชูููุฐ ุจุฏูู ุฃุฎุทุงุก
- [ ] ุงูู concurrency handling ูุนูู
- [ ] ุงูุฃุฏุงุก ููุจูู (< 2 ุซุงููุฉ ููุนูููุงุช)

## ๐ ุงูุฏุนู

### ูู ุญุงูุฉ ูุฌูุฏ ูุดุงูู:
1. ุงูุญุต logs ูู Windows Event Viewer
2. ุงูุญุต PostgreSQL logs ูู `pg_log` folder
3. ุงุณุชุฎุฏู ุงูุงุณุชุนูุงูุงุช ุงูุชุดุฎูุตูุฉ ุงููุฐููุฑุฉ ุฃุนูุงู
4. ุฑุงุฌุน ููู `MULTI_USER_IMPLEMENTATION.md`

### ูุนูููุงุช ูููุฏุฉ ููุฏุนู:
- ุนุฏุฏ ุงููุณุชุฎุฏููู ุงููุดุทูู
- ููุน ุงูุฎุทุฃ ูุงูุฑุณุงูุฉ
- ููุช ุญุฏูุซ ุงููุดููุฉ
- ุฎุทูุงุช ุฅุนุงุฏุฉ ุฅูุชุงุฌ ุงููุดููุฉ
- ูุชุงุฆุฌ ุงูุงุณุชุนูุงูุงุช ุงูุชุดุฎูุตูุฉ

## ๐ ุงูุชุญุฏูุซุงุช ุงููุณุชูุจููุฉ

ุชุชุถูู ุงูุฎุทุท ุงููุณุชูุจููุฉ:
- [ ] Real-time notifications
- [ ] Lock indication ูู ุงููุงุฌูุฉ
- [ ] Performance dashboard
- [ ] Advanced analytics
- [ ] Automated monitoring

---

**ุชู ุงูุชุญุฏูุซ:** 13 ูุจุฑุงูุฑ 2026
**ุงูุฅุตุฏุงุฑ:** 1.0
**ุงูุญุงูุฉ:** ุฌุงูุฒ ููุฅูุชุงุฌ โ
