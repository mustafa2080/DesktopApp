# โ ุชู ุฅูุฌุงุฒ ุชุนุฏููุงุช ูุณู ุงูุนูุฑุฉ - ููุฎุต ุงูุชุบููุฑุงุช

## ๐ ููุฎุต ุงูุชุนุฏููุงุช ุงูููุฌุฒุฉ:

### 1. โ ุชุนุฏูู Entity (UmrahPackage.cs)
- โ ุฅุถุงูุฉ `BusesCount` (ุนุฏุฏ ุงูุจุงุตุงุช)
- โ ุฅุถุงูุฉ `BusPriceSAR` (ุณุนุฑ ุงูุจุงุต ุจุงูุฑูุงู)
- โ ุฅุถุงูุฉ ุฎุงุตูุฉ ูุญุณูุจุฉ `BusPriceEGP` (ุงูุชุญููู ููุฌููู)
- โ ุฅุถุงูุฉ `GiftsPrice` (ุณุนุฑ ุงููุฏุงูุง ุจุงูุฌููู)
- โ ุฅุถุงูุฉ `OtherExpenses` (ูุตุฑููุงุช ุฃุฎุฑู ุจุงูุฌููู)
- โ ุฅุถุงูุฉ `OtherExpensesNotes` (ููุงุญุธุงุช ุงููุตุฑููุงุช ุงูุฃุฎุฑู)
- โ ุชุบููุฑ `SupervisorExpenses` ูู `SupervisorExpensesSAR` (ุจุงูุฑูุงู)
- โ ุฅุถุงูุฉ ุฎุงุตูุฉ ูุญุณูุจุฉ `SupervisorExpensesEGP` (ุงูุชุญููู ููุฌููู)
- โ ุชุบููุฑ `ProfitMargin` (%) ุฅูู `ProfitMarginEGP` (ุจุงูุฌููู ุงููุตุฑู)
- โ ุชุญุฏูุซ ุญุณุงุจ `TotalCosts` ููุดูู ุฌููุน ุงููุตุฑููุงุช ุงูุฌุฏูุฏุฉ
- โ ุชุญุฏูุซ ุญุณุงุจ `CalculatedSellingPrice` = ุงูุชูุงููู + ูุงูุด ุงูุฑุจุญ ุจุงูุฌููู

### 2. โ ุฅูุดุงุก Migration ููู Database
- โ ููู: `20260216000000_AddUmrahEnhancements.cs`
- โ ุฌุงูุฒ ููุชุทุจูู ุจุฃูุฑ: `dotnet ef database update`

### 3. โ ุชุนุฏูู Form (AddEditUmrahPackageForm.cs)

#### ุฃ) ุฅุถุงูุฉ Controls ุงูุฌุฏูุฏุฉ:
```csharp
private NumericUpDown _numBusesCount = null!;           // ุนุฏุฏ ุงูุจุงุตุงุช
private NumericUpDown _numBusPriceSAR = null!;          // ุณุนุฑ ุงูุจุงุต ุจุงูุฑูุงู
private NumericUpDown _numGiftsPrice = null!;           // ุณุนุฑ ุงููุฏุงูุง
private NumericUpDown _numOtherExpenses = null!;        // ูุตุฑููุงุช ุฃุฎุฑู
private TextBox _txtOtherExpensesNotes = null!;         // ููุงุญุธุงุช ุงููุตุฑููุงุช
private NumericUpDown _numProfitMarginEGP = null!;      // ูุงูุด ุงูุฑุจุญ ุจุงูุฌููู
private NumericUpDown _numSupervisorExpensesSAR = null!; // ูุตุงุฑูู ุงููุดุฑู ุจุงูุฑูุงู
private Label _lblBusEGP = null!;                       // ุนุฑุถ ุณุนุฑ ุงูุจุงุตุงุช ุจุงูุฌููู
private Label _lblSupervisorEGP = null!;                // ุนุฑุถ ูุตุงุฑูู ุงููุดุฑู ุจุงูุฌููู
```

#### ุจ) ุชุญุฏูุซ InitializeControls():
- โ ุฅุถุงูุฉ 5 ุตููู ุฌุฏูุฏุฉ ูู ูุณู ุงูุฃุณุนุงุฑ:
  1. ุนุฏุฏ ุงูุจุงุตุงุช + ุณุนุฑ ุงูุจุงุต (ุจุงูุฑูุงู ูุน ุณุนุฑ ุงูุตุฑู)
  2. ุณุนุฑ ุงููุฏุงูุง (ุจุงูุฌููู)
  3. ูุตุฑููุงุช ุฃุฎุฑู + ููุงุญุธุงุช (ุจุงูุฌููู)
  4. ูุงูุด ุงูุฑุจุญ (ุจุงูุฌููู ุงููุตุฑู ูุด ูุณุจุฉ ูุฆููุฉ)
- โ ุชุนุฏูู ุตู ูุตุงุฑูู ุงููุดุฑู: ูู ุฌููู ุฅูู ุฑูุงู ูุน ุณุนุฑ ุงูุตุฑู

#### ุฌ) ุชุญุฏูุซ CalculateTotals():
```csharp
- โ ุญุณุงุจ busEGP = busPriceSAR ร exchangeRate ร busesCount
- โ ุญุณุงุจ supervisorEGP = supervisorExpensesSAR ร exchangeRate
- โ ุฅุถุงูุฉ ุฌููุน ุงููุตุฑููุงุช ุงูุฌุฏูุฏุฉ ูู totalCosts:
    * busEGP
    * GiftsPrice
    * OtherExpenses
    * supervisorEGP (ุจุฏูุงู ูู SupervisorExpenses)
- โ ุชุบููุฑ ุทุฑููุฉ ุญุณุงุจ ุณุนุฑ ุงูุจูุน:
    ูู: sellingPrice = totalCosts ร (1 + profitMargin%)
    ุฅูู: sellingPrice = totalCosts + profitMarginEGP
```

#### ุฏ) ุชุญุฏูุซ LoadPackageDataAsync():
- โ ุชุญููู ุฌููุน ุงูุญููู ุงูุฌุฏูุฏุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- โ ุชุบููุฑ ูู `SupervisorExpenses` ุฅูู `SupervisorExpensesSAR`

#### ูู) ุชุญุฏูุซ BtnSave_Click():
- โ ุญูุธ ุฌููุน ุงูููู ุงูุฌุฏูุฏุฉ ูู ูุงุฆู UmrahPackage
- โ ุชุบููุฑ ูู `SupervisorExpenses` ุฅูู `SupervisorExpensesSAR`

---

## ๐ฏ ุงูุฎูุงุตุฉ - ูุง ุชู ุฅูุฌุงุฒู:

### ุงูุชุบููุฑุงุช ุงูุฑุฆูุณูุฉ:
1. โ **ุนุฏุฏ ุงูุจุงุตุงุช**: ุฅุถุงูุฉ ุญูู ูุนุฏุฏ ุงูุจุงุตุงุช ูุน ุณุนุฑ ุงูุจุงุต ุงููุงุญุฏ ุจุงูุฑูุงู
2. โ **ุณุนุฑ ุงููุฏุงูุง**: ุญูู ุฌุฏูุฏ ุจุงูุฌููู ุงููุตุฑู
3. โ **ูุตุฑููุงุช ุฃุฎุฑู**: ุญูู ูููุตุฑููุงุช + ุญูู ููุงุญุธุงุช ูุชูุงุตูู ุงููุตุฑููุงุช
4. โ **ูุตุงุฑูู ุงููุดุฑู**: ุชุญููู ูู ุฌููู ุฅูู ุฑูุงู ูุน ุณุนุฑ ุงูุตุฑู ุงูุชููุงุฆู
5. โ **ูุงูุด ุงูุฑุจุญ**: ุชุญููู ูู ูุณุจุฉ ูุฆููุฉ (%) ุฅูู ูุจูุบ ุซุงุจุช ุจุงูุฌููู ุงููุตุฑู

### ุทุฑููุฉ ุงูุญุณุงุจ ุงูุฌุฏูุฏุฉ:
```
ุงูุชูุงููู ุงููููุฉ = 
    ุงูุชุฃุดูุฑุฉ (ุฑูุงู ร ุตุฑู) +
    ุงูุฅูุงูุฉ +
    ุงูุจุงุฑููุฏ +
    ุงูุทูุฑุงู +
    ุงููุทุงุฑ ุงูุณุฑูุน (ุฑูุงู ร ุตุฑู) +
    ุงูุจุงุตุงุช (ุนุฏุฏ ร ุณุนุฑ ุฑูุงู ร ุตุฑู) +      [ุฌุฏูุฏ]
    ุงููุฏุงูุง +                               [ุฌุฏูุฏ]
    ูุตุฑููุงุช ุฃุฎุฑู +                          [ุฌุฏูุฏ]
    ุงูุนูููุฉ +
    ูุตุงุฑูู ุงููุดุฑู (ุฑูุงู ร ุตุฑู)              [ูุนุฏู]

ุณุนุฑ ุงูุจูุน = ุงูุชูุงููู + ูุงูุด ุงูุฑุจุญ (ุฌููู)  [ูุนุฏู - ูุงู ูุณุจุฉ ูุฆููุฉ]
```

---

## ๐ ุงูุฎุทูุงุช ุงูุชุงููุฉ ููุชุทุจูู:

### 1. ุชุทุจูู Migration ุนูู ูุงุนุฏุฉ ุงูุจูุงูุงุช:
```bash
cd C:\Users\musta\Desktop\pro\accountant
dotnet ef database update
```

### 2. Build ุงููุดุฑูุน:
```bash
dotnet build
```

### 3. ุชุดุบูู ุงููุดุฑูุน ูุงุฎุชุจุงุฑ:
```bash
dotnet run
```

---

## โ๏ธ ููุงุญุธุงุช ูููุฉ:

1. **ุงูุจูุงูุงุช ุงููุฏููุฉ**: ุงูุจุงูุฏุฌุงุช ุงููุฏููุฉ ุณุชุญุชูู ุนูู ููู ุตูุฑ ููุญููู ุงูุฌุฏูุฏุฉ (BusesCount, BusPriceSAR, etc.)
2. **Backward Compatibility**: ุงูุนููุฏ `SupervisorExpenses` ุชู ุชุบููุฑ ุงุณูู ูู `SupervisorExpensesSAR` - ุชุฃูุฏ ูู ุนุฏู ูุฌูุฏ ููุฏ ูุฏูู ูุณุชุฎุฏู ุงูุงุณู ุงููุฏูู
3. **ุงูุญุณุงุจุงุช**: ุฌููุน ุงูุญุณุงุจุงุช ุงูุขู ุชุฃุฎุฐ ุงููุตุฑููุงุช ุงูุฌุฏูุฏุฉ ุจุนูู ุงูุงุนุชุจุงุฑ
4. **ูุงุฌูุฉ ุงููุณุชุฎุฏู**: ุงูููุฑู ุงูุขู ุฃุทูู - ุชุฃูุฏ ูู scroll ูุนูู ุจุดูู ุตุญูุญ

---

## ๐ ูููุงุช ุชู ุชุนุฏูููุง:

1. โ `Domain/Entities/UmrahPackage.cs` - ุชุนุฏูู Entity
2. โ `Infrastructure/Migrations/20260216000000_AddUmrahEnhancements.cs` - Migration ุฌุฏูุฏ
3. โ `Presentation/Forms/AddEditUmrahPackageForm.cs` - ุชุนุฏูู ุงูููุฑู

---

ุชู ุฅูุฌุงุฒ ุฌููุน ุงูุชุนุฏููุงุช ุงููุทููุจุฉ ุจูุฌุงุญ! ๐
